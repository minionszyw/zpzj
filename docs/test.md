# 子平真君 AI 全链路验收测试方案 (生产级版)

此方案旨在验证全栈功能的完整性、算法的专业深度以及系统的生产环境健壮性。

---

## 1. 前端功能矩阵与覆盖验证 (Frontend Feature Matrix)

### 1.1 认证模块 (Auth)
- [x] **登录流**：邮箱校验 -> 验证码发送 -> JWT 接收与本地持久化。
- [x] **异常处理**：修复了复杂错误对象渲染导致的 React 崩溃。

### 1.2 咨询模块 (Consultation/Chat)
- [x] **会话管理**：实现了会话列表、与档案强绑定及级联删除。
- [x] **对话窗口**：
    - [x] **SSE 流式渲染**：支持 Markdown 实时解析与自动滚动。
    - [ ] **脚注交互**：点击 AI 回复中的引用编号弹出原文 (Pending)。

### 1.3 命理排盘模块 (Bazi Chart)
- [x] **核心展示**：四柱五行颜色匹配（木绿、火红、土黄、金灰、水蓝）。
- [x] **运程下钻**：大运 -> 流年 -> 流月三级钻取系统。

---

## 2. 隐蔽问题专项测试 (Edge Cases & Hidden Bugs)

### 2.1 算法与地理边界
- [x] **经度补偿**：验证了喀什 (76°E) vs 北京 (116°E) 的真太阳时校正。
- [x] **子时跳变**：验证了 Sect 1 (23点换日) 模式下的日柱精准切换。

### 2.2 状态一致性
- [x] **路由刷新**：验证了 SPA 在 Nginx 容器中的 404 刷新回退逻辑。
- [x] **级联清理**：解决了删除会话时因消息外键导致的 IntegrityError。

---

## 3. 生产级稳定性验收 (Production Candidate) - **New**

### 3.1 安全防御 (Security)
- [ ] **S1: 接口限流**：同一邮箱 1 分钟内请求 >3 次验证码应返回 429。
- [ ] **S2: 敏感数据遮蔽**：日志中严禁出现明文 LLM_API_KEY 或用户 Token。

### 3.2 极端场景 (Stress Test)
- [ ] **A1: 节气瞬间校验**：测试 2024-02-04 16:27 (立春点) 的年柱准确性。
- [ ] **A2: 摘要节点压力**：连续快速对话，验证 `summarize` 节点的原子性与稳定性。

### 3.3 故障注入 (Resilience)
- [ ] **F1: API 超时容错**：模拟 LLM 响应延迟 >30s，前端应有友好提示而非白屏。

---

## 4. 验收工具集

| 工具 | 用途 |
| :--- | :--- |
| **Playwright** | UI 自动化、并发模拟、多分辨率适配。 |
| **Redis CLI** | 校验限流计数器（Rate Limit）及验证码 TTL。 |
| **docker stats** | 监控高并发下容器资源水位。 |

---

## 5. 验收标记 (Done)

- [x] **D1: 前端全 Tab 移动端适配完成** (2026-01-09)
- [x] **D2: 真太阳时高精度计算验证** (2026-01-09)
- [x] **D3: 级联删除与外键约束修复** (2026-01-09)
- [ ] **P1: 后端接口限流 (Rate Limiting)** (Pending)
- [ ] **P2: 自动摘要节点灵敏度调优** (Pending)