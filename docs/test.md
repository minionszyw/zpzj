# 子平真君 AI 全链路验收测试方案 (生产级版)

此方案旨在验证全栈功能的完整性、算法的专业深度以及系统的生产环境健壮性。

---

## 1. 前端功能矩阵与覆盖验证 (Frontend Feature Matrix)

### 1.1 认证模块 (Auth)
- [x] **登录流**：邮箱校验 -> 验证码发送 -> JWT 接收与本地持久化。 (Done)
- [x] **异常处理**：支持 FastAPI 422 错误解析，UI 不崩溃。 (Done)

### 1.2 咨询模块 (Consultation/Chat)
- [x] **会话管理**：实现了会话列表、强绑定及级联清理。 (Done)
- [x] **对话窗口**：
    - [x] **SSE 流式渲染**：支持 Markdown 实时解析与自动滚动。 (Done)
    - [x] **故障容错**：API 离线时显示“服务维护”友好提示。 (Done)

### 1.3 命理排盘模块 (Bazi Chart)
- [x] **核心展示**：四柱五行颜色匹配。 (Done)
- [x] **运程下钻**：大运 -> 流年 -> 流月三级钻取系统。 (Done)

---

## 2. 隐蔽问题专项测试 (Edge Cases & Hidden Bugs)

### 2.1 算法与地理边界
- [x] **经度补偿**：验证了喀什 (76°E) vs 北京 (116°E) 的 3 小时真太阳时校正。 (Done)
- [x] **子时跳变**：验证了 Sect 1 模式下的日柱精准切换。 (Done)
- [x] **节气瞬间**：修复了立春时刻年柱不切换的 Bug，验证了 2024 立春点精准切换。 (Done)

### 2.2 系统稳健性
- [x] **路由刷新**：Nginx SPA 刷新回退逻辑验证通过。 (Done)
- [x] **摘要持久化**：修复了异步 Session 下摘要无法存入数据库的 Bug。 (Done)

---

## 3. 生产级稳定性验收 (Production Candidate)

### 3.1 安全防御
- [x] **S1: 接口限流**：同一邮箱 1 分钟内 >3 次请求成功触发 429。 (Done)
- [x] **S2: Token 过期**：修改 SECRET_KEY 后旧 Token 立即失效 (返回 403)。 (Done)

### 3.2 极端场景
- [x] **A1: 节气瞬间校验**：精准到分钟级的干支历切换验证。 (Done)
- [x] **A2: 摘要节点压力**：连续 20 轮对话测试通过，Token 窗口管理正常。 (Done)

### 3.3 故障注入
- [x] **F1: API 离线模拟**：捕获 404/500 错误并向用户展示维护信息。 (Done)

---

## 4. 验收标记 (Done)

- [x] **D1: 全链路算法与交互生产级核验通过** (2026-01-09)
- [x] **D2: 安全与容错机制整改完成** (2026-01-09)